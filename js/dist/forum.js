module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=29)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.extend},function(t,e,n){"use strict";function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}n.d(e,"a",(function(){return r}))},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/Badge"]},,function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["utils/humanTime"]},function(t,e){t.exports=flarum.core.compat["models/Discussion"]},function(t,e){t.exports=flarum.core.compat["components/Post"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},,function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["helpers/userOnline"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["utils/DiscussionControls"]},,,function(t,e,n){"use strict";n.r(e);var r=n(1),o=n(0),a=n.n(o),s=n(17),i=n.n(s),u=n(13),c=n.n(u),l=n(7),p=n.n(l),d=n(3),f=n.n(d),h=n(2),b=n(18),w=function(t){function e(){return t.apply(this,arguments)||this}return Object(h.a)(e,t),e}(n.n(b)()(f.a,{last_read_at:f.a.attribute("last_read_at"),last_read_post_number:f.a.attribute("last_read_post_number"),subscription:f.a.attribute("subscription"),unread:f.a.attribute("unread"),user:f.a.hasOne("user")})),k=n(5),_=n.n(k),x=n(19),y=n.n(x),g=n(6),v=n.n(g),R=n(10),O=n.n(R),j=n(11),W=n.n(j),P=n(4),B=n.n(P),N=n(12),I=n.n(N),D=n(9),M=n.n(D),U="clarkwinkelmann-who-read.forum.badges.",C=function(t,e){if(flarum.extensions["flarum-subscriptions"])switch(e.subscription()){case"follow":t.add("subscriptions-follow",p.a.component({label:a.a.translator.trans(U+"following"),icon:"fas fa-star",type:"following"}));break;case"ignore":t.add("subscriptions-ignoring",p.a.component({label:a.a.translator.trans(U+"ignoring"),icon:"far fa-eye-slash",type:"ignoring"}))}e.unread()&&t.add("who-read-unread",p.a.component({type:"who-read-unread",icon:a.a.forum.attribute("who-read.unreadIcon"),label:a.a.translator.trans(U+"unread")}))},S=function(t){function e(){return t.apply(this,arguments)||this}return Object(h.a)(e,t),e.prototype.view=function(){var t=this,e=a.a.forum.attribute("who-read.maxVisible");return m("ul.WhoRead-list.WhoRead-summary",this.props.readers.map((function(n,r){if(!t.showAll){if(r===e){var o=t.props.readers.length-e;return m("span.Avatar.WhoRead-more",{title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.more."+(t.props.extendable?"show":"info"),{count:o})),onclick:function(e){t.props.extendable&&(e.stopPropagation(),t.showAll=!0)}},"+"+o)}if(r>=e)return null}var s=n.user();if(!s)return null;var i=new M.a;C(i,n);var u=n.unread()||t.props.discussion&&n.last_read_post_number()<t.props.discussion.lastPostNumber(),c="last-read-at";return t.props.discussion&&(c=u?"last-read-at-behind":"last-read-at-up-to-date"),m("li.WhoRead-item",m("span",{title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip."+c,{user:s,ago:I()(n.last_read_at())})),config:function(t){$(t).tooltip({placement:"top"})}},[m(".WhoRead-avatar",{className:u?"WhoRead-avatar--outdated":""},[O()(s),m("ul.badges",W()(i.toArray()))])]))})))},e}(v.a),A=n(20),L=n.n(A),E=n(21),H=n.n(E),T=n(22),F=n.n(T),q=function(t){function e(){return t.apply(this,arguments)||this}return Object(h.a)(e,t),e.prototype.view=function(){return m("ul.WhoRead-list.WhoRead-details",this.props.readers.map((function(t){var e=t.user();if(!e)return null;var n=e.badges();return C(n,t),m("li.WhoRead-item",m("a",{href:a.a.route.user(e),title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip.last-read-at",{user:e,ago:I()(t.last_read_at())})),config:function(t){$(t).tooltip({placement:"top"}),m.route.apply(this,arguments)}},[m(".WhoRead-avatar",[O()(e),m("ul.badges",W()(n.toArray()))]),m(".WhoRead-user",[F()(e),H()(e)])]))})))},e}(v.a),z=function(t){function e(){return t.apply(this,arguments)||this}Object(h.a)(e,t);var n=e.prototype;return n.title=function(){return app.translator.trans("clarkwinkelmann-who-read.forum.modal.title")},n.content=function(){return m(".Modal-body",[this.section("readersUntilHereOnly","up-to-this-post"),this.section("readersFurther","past-this-post"),this.section("readersEnd","to-the-end"),this.section("readersBehind","behind")])},n.section=function(t,e){return this.props[t]&&this.props[t].length?[m("h3",app.translator.trans("clarkwinkelmann-who-read.forum.modal."+e)),q.component({readers:this.props[t]})]:null},e}(L.a),V=function(t,e){return t.filter((function(t){if(null===t.last_read_post_number())return!1;var n=a.a.forum.attribute("who-read.hideWhenBehind");return!n||t.last_read_post_number()>e.lastPostNumber()-n}))},G=n(23),J=n.n(G),K=n(24),Q=n.n(K),X=n(25),Y=n.n(X),Z=n(14),tt=n.n(Z),et=n(15),nt=n.n(et),rt=function(t){function e(){return t.apply(this,arguments)||this}return Object(h.a)(e,t),e.prototype.view=function(){var t=this.props,e=t.discussion,n=t.className,r=!!e.attribute("whoReadUnread");return _.a.component({className:n,icon:a.a.forum.attribute("who-read.unreadIcon"),children:a.a.translator.trans("clarkwinkelmann-who-read.forum.controls."+(r?"remove":"set")+"-unread"),onclick:function(){e.save({whoReadUnread:!r}).then((function(){m.redraw()}))}})},e}(v.a),ot=n(26),at=n.n(ot);a.a.initializers.add("clarkwinkelmann-who-read",(function(){a.a.store.models["clarkwinkelmann-who-readers"]=w,c.a.prototype.clarkwinkelmannWhoReaders=c.a.hasMany("clarkwinkelmannWhoReaders"),Object(r.extend)(c.a.prototype,"badges",(function(t){this.attribute("whoReadUnread")&&t.add("who-read-unread",p.a.component({type:"who-read-unread",icon:a.a.forum.attribute("who-read.unreadIcon"),label:a.a.translator.trans("clarkwinkelmann-who-read.forum.badges.unread")}))})),Object(r.extend)(f.a.prototype,"save",(function(t,e){e.lastReadPostNumber&&t.then((function(){m.redraw()}))})),Object(r.extend)(i.a.prototype,"params",(function(t){a.a.forum.attribute("who-read.canSee")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(r.extend)(y.a.prototype,"items",(function(t){var e=this;if(a.a.forum.attribute("who-read.showInHero")){var n=this.props.discussion.clarkwinkelmannWhoReaders();n&&(n=V(n,this.props.discussion)).length&&t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(new z({readersEnd:n.filter((function(t){return t.last_read_post_number()>=e.props.discussion.lastPostNumber()})),readersBehind:n.filter((function(t){return t.last_read_post_number()<e.props.discussion.lastPostNumber()}))}))}},[S.component({readers:n,discussion:this.props.discussion,extendable:!0})]))}})),Object(r.extend)(J.a.prototype,"requestParams",(function(t){a.a.forum.attribute("who-read.showInDiscussionList")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(r.extend)(Q.a.prototype,"infoItems",(function(t){if(a.a.forum.attribute("who-read.showInDiscussionList")){var e=this.props.discussion.clarkwinkelmannWhoReaders();e&&(e=V(e,this.props.discussion)).length&&t.add("who-read",S.component({readers:e,discussion:this.props.discussion}),-120)}})),Object(r.extend)(tt.a.prototype,"init",(function(){var t=this;a.a.forum.attribute("who-read.showBetweenPosts")&&this.subtree.check((function(){return t.props.post.discussion().attribute("whoReadUnread")}),(function(){return t.props.post.discussion().lastReadPostNumber()}))})),[tt.a,Y.a].forEach((function(t){Object(r.extend)(t.prototype,"footerItems",(function(t){var e=this;if(a.a.forum.attribute("who-read.showBetweenPosts")){var n=this.props.post.discussion();if(n.data.relationships&&n.data.relationships.posts){var r=n.postIds(),o=r.indexOf(this.props.post.id());if(-1!==o&&o+1<r.length){var s=r[o+1],i=a.a.store.getById("posts",s);if(i){var u=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=e.props.post.number()&&t.last_read_post_number()<i.number()})),c=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=i.number()}));t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(new z({readersUntilHereOnly:u,readersFurther:c}))},title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.footer.to-here-"+(u.length?"some-stopped":c.length?"none-stopped":"nobody"),{total:u.length+c.length,stopped:u.length}))},[a.a.forum.attribute("who-read.showCountOfReadersWhoStopped")?u.length:u.length+c.length," ",nt()("fas fa-check-double")," ",S.component({readers:u})]))}}else if(o===r.length-1){var l=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=n.lastPostNumber()}));t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(new z({readersEnd:l}))},title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.footer.to-end"+(l.length?"":"-nobody"),{total:l.length}))},[l.length," ",nt()("fas fa-check-double")," ",S.component({readers:l})])),n.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",rt.component({className:"Button",discussion:n}))}}}}))})),Object(r.extend)(at.a,"userControls",(function(t,e){e.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",rt.component({discussion:e}))}))}))}]);
//# sourceMappingURL=forum.js.map