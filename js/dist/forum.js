module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=30)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.extend},function(t,e,n){"use strict";function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}n.d(e,"a",(function(){return r}))},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/Badge"]},,function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["utils/humanTime"]},function(t,e){t.exports=flarum.core.compat["models/Discussion"]},function(t,e){t.exports=flarum.core.compat["components/Post"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},,function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["components/Link"]},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["helpers/userOnline"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat.Translator},,,function(t,e,n){"use strict";n.r(e);var r=n(1),a=n(0),o=n.n(a),s=n(17),i=n.n(s),u=n(13),c=n.n(u),l=n(7),d=n.n(l),p=n(4),f=n.n(p);function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var b=n(2);function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var k=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return w(h(e=t.call.apply(t,[this].concat(r))||this),"last_read_at",f.a.attribute("last_read_at")),w(h(e),"last_read_post_number",f.a.attribute("last_read_post_number")),w(h(e),"subscription",f.a.attribute("subscription")),w(h(e),"unread",f.a.attribute("unread")),w(h(e),"user",f.a.hasOne("user")),e}return Object(b.a)(e,t),e}(f.a),v=n(5),x=n.n(v),_=n(18),g=n.n(_),y=n(6),R=n.n(y),O=n(10),j=n.n(O),P=n(11),W=n.n(P),I=n(3),N=n.n(I),B=n(12),D=n.n(B),M=n(9),C=n.n(M),E="clarkwinkelmann-who-read.forum.badges.",U=function(t,e){if(flarum.extensions["flarum-subscriptions"])switch(e.subscription()){case"follow":t.add("subscriptions-follow",d.a.component({label:o.a.translator.trans(E+"following"),icon:"fas fa-star",type:"following"}));break;case"ignore":t.add("subscriptions-ignoring",d.a.component({label:o.a.translator.trans(E+"ignoring"),icon:"far fa-eye-slash",type:"ignoring"}))}e.unread()&&t.add("who-read-unread",d.a.component({type:"who-read-unread",icon:o.a.forum.attribute("who-read.unreadIcon"),label:o.a.translator.trans(E+"unread")}))},S=function(t){function e(){return t.apply(this,arguments)||this}return Object(b.a)(e,t),e.prototype.view=function(){var t=this,e=o.a.forum.attribute("who-read.maxVisible"),n=this.attrs,r=n.readers,a=n.extendable,s=n.discussion;return m("ul.WhoRead-list.WhoRead-summary",r.map((function(n,i){if(!t.showAll){if(i===e){var u=r.length-e;return m("span.Avatar.WhoRead-more",{title:N()(o.a.translator.trans("clarkwinkelmann-who-read.forum.more."+(a?"show":"info"),{count:u})),onclick:function(e){a&&(e.stopPropagation(),t.showAll=!0)}},"+"+u)}if(i>=e)return null}var c=n.user();if(!c)return null;var l=new C.a;U(l,n);var d=n.unread()||s&&n.last_read_post_number()<s.lastPostNumber(),p="last-read-at";return s&&(p=d?"last-read-at-behind":"last-read-at-up-to-date"),m("li.WhoRead-item",m("span",{title:N()(o.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip."+p,{user:c,ago:D()(n.last_read_at())})),oncreate:function(t){$(t.dom).tooltip({placement:"top"})}},[m(".WhoRead-avatar",{className:d?"WhoRead-avatar--outdated":""},[j()(c),m("ul.badges",W()(l.toArray()))])]))})))},e}(R.a),A=n(19),L=n.n(A),T=n(20),H=n.n(T),z=n(21),F=n.n(z),q=n(22),V=n.n(q),G=function(t){function e(){return t.apply(this,arguments)||this}return Object(b.a)(e,t),e.prototype.view=function(){return m("ul.WhoRead-list.WhoRead-details",this.props.readers.map((function(t){var e=t.user();if(!e)return null;var n=e.badges();return U(n,t),m("li.WhoRead-item",m(H.a,{href:o.a.route.user(e),title:N()(o.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip.last-read-at",{user:e,ago:D()(t.last_read_at())})),oncreate:function(t){$(t.dom).tooltip({placement:"top",viewport:{selector:".Modal",padding:10}})}},[m(".WhoRead-avatar",[j()(e),m("ul.badges",W()(n.toArray()))]),m(".WhoRead-user",[V()(e),F()(e)])]))})))},e}(R.a),J=function(t){function e(){return t.apply(this,arguments)||this}Object(b.a)(e,t);var n=e.prototype;return n.title=function(){return o.a.translator.trans("clarkwinkelmann-who-read.forum.modal.title")},n.content=function(){return m(".Modal-body",[this.section("readersUntilHereOnly","up-to-this-post"),this.section("readersFurther","past-this-post"),this.section("readersEnd","to-the-end"),this.section("readersBehind","behind")])},n.section=function(t,e){return this.attrs[t]&&this.attrs[t].length?[m("h3",o.a.translator.trans("clarkwinkelmann-who-read.forum.modal."+e)),G.component({readers:this.attrs[t]})]:null},e}(L.a),K=function(t,e){return t.filter((function(t){if(null===t.last_read_post_number())return!1;var n=o.a.forum.attribute("who-read.hideWhenBehind");return!n||t.last_read_post_number()>e.lastPostNumber()-n}))},Q=n(23),X=n.n(Q),Y=n(24),Z=n.n(Y),tt=n(25),et=n.n(tt),nt=n(14),rt=n.n(nt),at=n(15),ot=n.n(at),st=function(t){function e(){return t.apply(this,arguments)||this}return Object(b.a)(e,t),e.prototype.view=function(){var t=this.attrs,e=t.discussion,n=t.className,r=!!e.attribute("whoReadUnread");return x.a.component({className:n,icon:o.a.forum.attribute("who-read.unreadIcon"),onclick:function(){e.save({whoReadUnread:!r}).then((function(){m.redraw()}))}},o.a.translator.trans("clarkwinkelmann-who-read.forum.controls."+(r?"remove":"set")+"-unread"))},e}(R.a),it=n(26),ut=n.n(it),ct=n(27),lt=n.n(ct);o.a.initializers.add("clarkwinkelmann-who-read",(function(){o.a.store.models["clarkwinkelmann-who-readers"]=k,c.a.prototype.clarkwinkelmannWhoReaders=c.a.hasMany("clarkwinkelmannWhoReaders"),Object(r.extend)(c.a.prototype,"badges",(function(t){this.attribute("whoReadUnread")&&t.add("who-read-unread",d.a.component({type:"who-read-unread",icon:o.a.forum.attribute("who-read.unreadIcon"),label:o.a.translator.trans("clarkwinkelmann-who-read.forum.badges.unread")}))})),Object(r.extend)(f.a.prototype,"save",(function(t,e){e.lastReadPostNumber&&t.then((function(){m.redraw()}))})),Object(r.extend)(i.a.prototype,"params",(function(t){o.a.forum.attribute("who-read.canSee")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(r.extend)(g.a.prototype,"items",(function(t){if(o.a.forum.attribute("who-read.showInHero")){var e=this.attrs.discussion,n=e.clarkwinkelmannWhoReaders();n&&(n=K(n,e)).length&&t.add("who-read",x.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),o.a.modal.show(J,{readersEnd:n.filter((function(t){return t.last_read_post_number()>=e.lastPostNumber()})),readersBehind:n.filter((function(t){return t.last_read_post_number()<e.lastPostNumber()}))})}},[S.component({readers:n,discussion:e,extendable:!0})]))}})),Object(r.extend)(X.a.prototype,"requestParams",(function(t){o.a.forum.attribute("who-read.showInDiscussionList")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(r.extend)(Z.a.prototype,"infoItems",(function(t){if(o.a.forum.attribute("who-read.showInDiscussionList")){var e=this.attrs.discussion,n=e.clarkwinkelmannWhoReaders();n&&(n=K(n,e)).length&&t.add("who-read",S.component({readers:n,discussion:e}),-120)}})),Object(r.extend)(rt.a.prototype,"oninit",(function(){var t=this;o.a.forum.attribute("who-read.showBetweenPosts")&&this.subtree.check((function(){return t.attrs.post.discussion().attribute("whoReadUnread")}),(function(){return t.attrs.post.discussion().lastReadPostNumber()}))})),[rt.a,et.a].forEach((function(t){Object(r.extend)(t.prototype,"footerItems",(function(t){if(o.a.forum.attribute("who-read.showBetweenPosts")){var e=this.attrs.post,n=e.discussion();if(n.data.relationships&&n.data.relationships.posts){var r=n.postIds(),a=r.indexOf(e.id());if(-1!==a&&a+1<r.length){var s=r[a+1],i=o.a.store.getById("posts",s);if(i){var u=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=e.number()&&t.last_read_post_number()<i.number()})),c=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=i.number()})),l=u.length+c.length,d=N()(o.a.translator.transChoice("clarkwinkelmann-who-read.forum.footer.read-this-post",l,{count:l}));l>0&&(d+=". "+N()(o.a.translator.transChoice("clarkwinkelmann-who-read.forum.footer.read-no-further",u.length,{count:u.length}))),t.add("who-read",x.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),o.a.modal.show(J,{readersUntilHereOnly:u,readersFurther:c})},title:d},[o.a.forum.attribute("who-read.showCountOfReadersWhoStopped")?u.length:l," ",ot()("fas fa-check-double")," ",S.component({readers:u})]))}}else if(a===r.length-1){var p=n.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=n.lastPostNumber()}));t.add("who-read",x.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),o.a.modal.show(J,{readersEnd:p})},title:N()(o.a.translator.transChoice("clarkwinkelmann-who-read.forum.footer.read-to-end",p.length,{count:p.length}))},[p.length," ",ot()("fas fa-check-double")," ",S.component({readers:p})])),n.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",st.component({className:"Button",discussion:n}))}}}}))})),Object(r.extend)(ut.a,"userControls",(function(t,e){e.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",st.component({discussion:e}))})),Object(r.override)(lt.a.prototype,"pluralize",(function(t,e,n){var r=new RegExp(/^\w+\: +(.+)$/),a=new RegExp(/^\s*((\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]]))\s?(.+?)$/),o=new RegExp(/^\s*(\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]])/),s=[],i={};for(var u in e.split("|").forEach((function(t){if(a.test(t)){var e=t.match(a);i[e[0]]=e[e.length-1]}else if(r.test(t)){var n=t.match(r);s.push(n[1])}else s.push(t)})),i)if(i.hasOwnProperty(u)&&o.test(u)){var c=u.match(o);if(c[1]){var l=c[2].split(",");for(var d in l)if(n===parseInt(l[d]))return i[u]}else{var p=this.convertNumber(c[4]),f=this.convertNumber(c[5]);if(("["===c[3]?n>=p:n>p)&&("]"===c[6]?n<=f:n<f))return i[u]}}return s[this.pluralPosition(n,this.locale)]||s[0]||void 0}))}))}]);
//# sourceMappingURL=forum.js.map