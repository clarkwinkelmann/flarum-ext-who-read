module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=27)}([function(t,e){t.exports=flarum.core.compat["forum/app"]},,function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/components/Badge"]},,function(t,e){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["common/utils/humanTime"]},function(t,e){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,e){t.exports=flarum.core.compat["forum/components/Post"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},,function(t,e){t.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["common/components/Link"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/helpers/userOnline"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["forum/components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,e,r){"use strict";r.r(e);var n=r(2),o=r(0),a=r.n(o),s=r(16),u=r.n(s),i=r(12),c=r.n(i),l=r(6),d=r.n(l),f=r(4),p=r.n(f);function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}var w=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).last_read_at=p.a.attribute("last_read_at"),e.last_read_post_number=p.a.attribute("last_read_post_number"),e.subscription=p.a.attribute("subscription"),e.unread=p.a.attribute("unread"),e.user=p.a.hasOne("user"),e}return b(e,t),e}(p.a),k=r(5),_=r.n(k),x=r(17),y=r.n(x),v=r(8),g=r.n(v),R=r(9),O=r.n(R),W=r(10),P=r.n(W),j=r(3),B=r.n(j),N=r(11),I=r.n(N),D=r(18),M=r.n(D),S="clarkwinkelmann-who-read.forum.badges.",U=function(t,e){if(flarum.extensions["flarum-subscriptions"])switch(e.subscription()){case"follow":t.add("subscriptions-follow",d.a.component({label:a.a.translator.trans(S+"following"),icon:"fas fa-star",type:"following"}));break;case"ignore":t.add("subscriptions-ignoring",d.a.component({label:a.a.translator.trans(S+"ignoring"),icon:"far fa-eye-slash",type:"ignoring"}))}e.unread()&&t.add("who-read-unread",d.a.component({type:"who-read-unread",icon:a.a.forum.attribute("who-read.unreadIcon"),label:a.a.translator.trans(S+"unread")}))},L=function(){function t(){}return t.prototype.view=function(t){var e=this,r=a.a.forum.attribute("who-read.maxVisible"),n=t.attrs,o=n.readers,s=n.extendable,u=n.discussion;return m("ul.WhoRead-list.WhoRead-summary",o.map((function(t,n){if(!e.showAll){if(n===r){var i=o.length-r;return m("span.Avatar.WhoRead-more",{title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.more."+(s?"show":"info"),{count:i})),onclick:function(t){s&&(t.stopPropagation(),e.showAll=!0)}},"+"+i)}if(n>=r)return null}var c=t.user();if(!c)return null;var l=new M.a;U(l,t);var d=t.unread()||u&&t.last_read_post_number()<u.lastPostNumber(),f="last-read-at";return u&&(f=d?"last-read-at-behind":"last-read-at-up-to-date"),m("li.WhoRead-item",m(g.a,{text:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip."+f,{user:c,ago:I()(t.last_read_at())}))},m(".WhoRead-avatar",{className:d?"WhoRead-avatar--outdated":""},[O()(c),m("ul.badges",P()(l.toArray()))])))})))},t}(),A=r(19),C=r.n(A),T=r(20),E=r.n(T),H=r(21),q=r.n(H),F=r(22),z=r.n(F),J=function(){function t(){}return t.prototype.view=function(t){return m("ul.WhoRead-list.WhoRead-details",t.attrs.readers.map((function(t){var e=t.user();if(!e)return null;var r=e.badges();return U(r,t),m("li.WhoRead-item",m(g.a,{text:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.tooltip.last-read-at",{user:e,ago:I()(t.last_read_at())}))},m(E.a,{href:a.a.route.user(e),"data-container":"body"},[m(".WhoRead-avatar",[O()(e),m("ul.badges",P()(r.toArray()))]),m(".WhoRead-user",[z()(e),q()(e)])])))})))},t}(),V=function(t){function e(){return t.apply(this,arguments)||this}b(e,t);var r=e.prototype;return r.title=function(){return a.a.translator.trans("clarkwinkelmann-who-read.forum.modal.title")},r.content=function(){return m(".Modal-body",[this.section("readersUntilHereOnly","up-to-this-post"),this.section("readersFurther","past-this-post"),this.section("readersEnd","to-the-end"),this.section("readersBehind","behind")])},r.section=function(t,e){return this.attrs[t]&&this.attrs[t].length?[m("h3",a.a.translator.trans("clarkwinkelmann-who-read.forum.modal."+e)),m(J,{readers:this.attrs[t]})]:null},e}(C.a),G=function(t,e){return t.filter((function(t){if(null===t.last_read_post_number())return!1;var r=a.a.forum.attribute("who-read.hideWhenBehind");return!r||t.last_read_post_number()>e.lastPostNumber()-r}))},K=r(23),Q=r.n(K),X=r(24),Y=r.n(X),Z=r(25),$=r.n(Z),tt=r(13),et=r.n(tt),rt=r(14),nt=r.n(rt),ot=function(){function t(){}return t.prototype.view=function(t){var e=t.attrs,r=e.discussion,n=e.className,o=!!r.attribute("whoReadUnread");return _.a.component({className:n,icon:a.a.forum.attribute("who-read.unreadIcon"),onclick:function(){r.save({whoReadUnread:!o}).then((function(){m.redraw()}))}},a.a.translator.trans("clarkwinkelmann-who-read.forum.controls."+(o?"remove":"set")+"-unread"))},t}(),at=r(26),st=r.n(at);a.a.initializers.add("clarkwinkelmann-who-read",(function(){a.a.store.models["clarkwinkelmann-who-readers"]=w,c.a.prototype.clarkwinkelmannWhoReaders=c.a.hasMany("clarkwinkelmannWhoReaders"),Object(n.extend)(c.a.prototype,"badges",(function(t){this.attribute("whoReadUnread")&&t.add("who-read-unread",d.a.component({type:"who-read-unread",icon:a.a.forum.attribute("who-read.unreadIcon"),label:a.a.translator.trans("clarkwinkelmann-who-read.forum.badges.unread")}))})),Object(n.extend)(p.a.prototype,"save",(function(t,e){e.lastReadPostNumber&&t.then((function(){m.redraw()}))})),Object(n.extend)(u.a.prototype,"requestParams",(function(t){a.a.forum.attribute("who-read.canSee")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(n.extend)(y.a.prototype,"items",(function(t){if(a.a.forum.attribute("who-read.showInHero")){var e=this.attrs.discussion,r=e.clarkwinkelmannWhoReaders();r&&(r=G(r,e)).length&&t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(V,{readersEnd:r.filter((function(t){return t.last_read_post_number()>=e.lastPostNumber()})),readersBehind:r.filter((function(t){return t.last_read_post_number()<e.lastPostNumber()}))})}},m(L,{readers:r,discussion:e,extendable:!0})))}})),Object(n.extend)(Q.a.prototype,"requestParams",(function(t){a.a.forum.attribute("who-read.showInDiscussionList")&&t.include.push("clarkwinkelmannWhoReaders.user.groups")})),Object(n.extend)(Y.a.prototype,"infoItems",(function(t){if(a.a.forum.attribute("who-read.showInDiscussionList")){var e=this.attrs.discussion,r=e.clarkwinkelmannWhoReaders();r&&(r=G(r,e)).length&&t.add("who-read",m(L,{readers:r,discussion:e}),-120)}})),Object(n.extend)(et.a.prototype,"oninit",(function(){var t=this;a.a.forum.attribute("who-read.showBetweenPosts")&&this.subtree.check((function(){return t.attrs.post.discussion().attribute("whoReadUnread")}),(function(){return t.attrs.post.discussion().lastReadPostNumber()}),(function(){return JSON.stringify((t.attrs.post.discussion().clarkwinkelmannWhoReaders()||[]).map((function(t){return[t.id(),t.unread(),t.last_read_post_number()]})))}))})),[et.a,$.a].forEach((function(t){Object(n.extend)(t.prototype,"footerItems",(function(t){if(a.a.forum.attribute("who-read.showBetweenPosts")){var e=this.attrs.post,r=e.discussion();if(r.data.relationships&&r.data.relationships.posts){var n=r.postIds(),o=n.indexOf(e.id());if(-1!==o&&o+1<n.length){var s=n[o+1],u=a.a.store.getById("posts",s);if(u){var i=r.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=e.number()&&t.last_read_post_number()<u.number()})),c=r.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=u.number()})),l=i.length+c.length,d=B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.footer.read-this-post",{count:l}));l>0&&(d+=". "+B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.footer.read-no-further",{count:i.length}))),t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(V,{readersUntilHereOnly:i,readersFurther:c})},title:d},[a.a.forum.attribute("who-read.showCountOfReadersWhoStopped")?i.length:l," ",nt()("fas fa-check-double")," ",m(L,{readers:i})]))}}else if(o===n.length-1){var f=r.clarkwinkelmannWhoReaders().filter((function(t){return t.last_read_post_number()>=r.lastPostNumber()}));t.add("who-read",_.a.component({className:"Button Button--link",onclick:function(t){t.preventDefault(),a.a.modal.show(V,{readersEnd:f})},title:B()(a.a.translator.trans("clarkwinkelmann-who-read.forum.footer.read-to-end",{count:f.length}))},[f.length," ",nt()("fas fa-check-double")," ",m(L,{readers:f})])),r.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",m(ot,{className:"Button",discussion:r}))}}}}))})),Object(n.extend)(st.a,"userControls",(function(t,e){e.attribute("whoReadCanMarkUnread")&&t.add("who-read-unread",m(ot,{discussion:e}))}))}))}]);
//# sourceMappingURL=forum.js.map